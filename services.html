<!DOCTYPE html>
<html lang="zh-Hans">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="icon" href="data:,">
</head>

<body>
    <form method="get" action="find_process" id="form1">
        <input type="text" name="cmd" placeholder="å‘½ä»¤è¡Œ" value="">
        <input type="submit" value="æŸ¥æ‰¾è¿›ç¨‹">
    </form>
    <hr style="margin:10px 0; border:0;">

    <h2>
        æœåŠ¡åˆ—è¡¨
    </h2>
    <p>
        <a href="javascript: (() => { const q = prompt('è¯·è¾“å…¥æœåŠ¡åç§°ï¼š', '.json'); if (q == null) return; location.href = 'update?name=' + q; })();">æ·»åŠ </a>
        <button onclick=" 
        const names = []; 
        document.querySelectorAll(`table > tbody tr td input[type='checkbox']:checked`).forEach(checkbox => names.push(checkbox.value)); 
        if (names.length == 0) { alert('ä½ è¿˜æ²¡æœ‰é€‰æ‹©ä»»ä½•ä¸€é¡¹'); return; }
        if (!confirm('å·²é€‰æ‹© ' + names.length + ' é¡¹ï¼Œ' + 'ä½ ç¡®å®šå—ï¼Ÿ')) return; this.disabled = true;
        (() => {
        fetch('start?name=' + encodeURIComponent(names.join(',')))
        .then(async (resp) => { text = await resp.text(); alert(text); this.disabled = false; location.reload(); })
        })();
        void(0);">å¯åŠ¨æ‰€é€‰</button>
        <button onclick=" 
        const names = []; 
        document.querySelectorAll(`table > tbody tr td input[type='checkbox']:checked`).forEach(checkbox => names.push(checkbox.value)); 
        if (names.length == 0) { alert('ä½ è¿˜æ²¡æœ‰é€‰æ‹©ä»»ä½•ä¸€é¡¹'); return; }
        if (!confirm('å·²é€‰æ‹© ' + names.length + ' é¡¹ï¼Œ' + 'ä½ ç¡®å®šå—ï¼Ÿ')) return; this.disabled = true;
        (() => {
        fetch('stop?name=' + encodeURIComponent(names.join(',')))
        .then(async (resp) => { text = await resp.text(); alert(text); this.disabled = false; location.reload(); })
        })();
        void(0);">åœæ­¢æ‰€é€‰</button>
        <hr style="margin:3px 0; border:0;">
        <table class="table table-striped" border="1" cellspacing="0">
            <thead>
                <tr>
                    <th><input type="checkbox" onclick="document.querySelectorAll(`table > tbody tr td input[type='checkbox']`).forEach(checkbox => checkbox.checked = this.checked);"></th>
                    <th>åç§°</th>
                    <th>å‘½ä»¤</th>
                    <th>å·¥ä½œç›®å½•</th>
                    <th>æ˜¯å¦å¯ç”¨</th>
                    <th>è¿›ç¨‹çŠ¶æ€</th>
                    <th>æ“ä½œ</th>
                    <th>è¿è¡Œæ—¥å¿—</th>
                </tr>
            </thead>
            <tbody>
            % for i, (name, service) in enumerate(services.items()):
                <tr>
                    <td><input type="checkbox" value="{{ service.name }}"></td>
                    <td style="padding: 5px;"><a href="{{ 'update?name=' + service.name + '.json' }}">{{ service.name }}</a></td>
                    <td><textarea name="cmd" cols="40" rows="3" style="border: none; outline: none;" readonly>{{ service.cmd }}</textarea></td>
                    <td style="padding: 5px;">{{ service.cwd }}</td>
                    <td style="padding: 5px;">{{ 'ğŸŸ¢' if service.is_enabled else 'âšª'}}</td>
                    <td style="padding: 5px;">{{ service.status() }}</td>
                    <td style="padding: 5px;">
                        <button onclick = "this.disabled = true;
                        (() => {
                            fetch('{{ "stop" if service.status().startswith("running") else "start" }}?name=' + encodeURIComponent('{{ service.name }}'))
                            .then(async (resp) => { text = await resp.text(); alert(text); this.disabled = false; location.reload(); }); 
                        })();
                        void(0);">{{ "åœæ­¢" if service.status().startswith("running") else "å¯åŠ¨" }}</button>
                        <button onclick="if (!confirm('ä½ ç¡®å®šå—ï¼Ÿ')) return; this.disabled = true;
                        (() => { 
                            fetch('delete?name=' + encodeURIComponent('{{ service.name }}' + '.json'))
                            .then(async (resp) => { text = await resp.text(); alert(text); this.disabled = false; location.reload(); }); 
                        })();" style="color: red;">åˆ é™¤</button>
                    </td>
                    <td style="padding: 5px;">
                        <a href="{{ 'log?name=' + service.name + '.json' }}">æŸ¥çœ‹</a>
                        <button onclick="if (!confirm('ä½ ç¡®å®šå—ï¼Ÿ')) return; this.disabled = true;
                        (() => { 
                            fetch('clear_log?name=' + encodeURIComponent('{{ service.name }}' + '.json'))
                            .then(async (resp) => { text = await resp.text(); alert(text); this.disabled = false; location.reload(); }); 
                        })();" style="color: orange;">æ¸…ç©º</button>
                    </td>
                    
                </tr>
            % end
            </tbody>
        </table>
        å…± {{ len(services) }} æ¡è®°å½•
    </p>

    <script>

    </script>
</body>

</html>